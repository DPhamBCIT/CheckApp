<!DOCTYPE HTML>
<html lang="en">
  <head>
   
    <title>CheckApp - Review</title>
    <meta charset = "UTF-8">
    <link rel="stylesheet" href="./css/style_review.css">
    
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDC_mefT3aFXROFBI4MHle7eBvI5Rj5zG0",
        authDomain: "nov15-27f6e.firebaseapp.com",
        databaseURL: "https://nov15-27f6e.firebaseio.com",
        projectId: "nov15-27f6e",
        storageBucket: "nov15-27f6e.appspot.com",
        messagingSenderId: "373575545421"
      };
      firebase.initializeApp(config);
    </script>
    
  </head>
  <body>
  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <table id="top_table">
      <tbody>
        <tr class = "debug">
          <td id="back">
            <div>
              <a href="overview.html">
                <img class="img_normal" alt="back" src="images/arrow_left.png"/>
                <img class="img_hover" alt="back" src="images/arrow_left_orange.png"/>
              </a>
            </div>
          </td>
          <td><input type="text" id="search" placeholder="Search"/></td>
          <td id="user"></td>
          <td id="bar">|</td>
          <td id="login"><a class="link" href ="login.html">Login</a></td>
          <td id="logout"><a class="link" href ="">Logout</a></td>
        </tr>
      </tbody>
    </table>
		
    <table id="page">
			<tbody>
				<tr>
					<td class = "bodysection">
						<p><span id="title">REVIEWS</span></p>
							<p><span id="reviewnum">?.?</span><span id ="reviewtext">/5 stars</span></p>
							<div id="bars">
							<div class="rectangle" id="bar5"><p>5</p></div>
							<div class="rectangle" id="bar4"><p>4</p></div>
							<div class="rectangle" id="bar3"><p>3</p></div>
							<div class="rectangle" id="bar2"><p>2</p></div>
							<div class="rectangle" id="bar1"><p>1</p></div>
						</div>
					</td>
					<td class = "bodysection_centered">
						<p>How many stars do you rate this game?</p>
						<span class="star"><img id="star1" src="./images/star.png" alt="star">
						<img id="star2" src="./images/star.png" alt="star">
						<img id="star3" src="./images/star.png" alt="star">
						<img id="star4" src="./images/star.png" alt="star">
						<img id="star5" src="./images/star.png" alt="star"></span><br/>
						<button class="button button1" id="submit">Submit</button>
					</td>
					<td class = "bodysection_centered">
						<span id = "app_img">
							<img src="https://i.pinimg.com/originals/f8/89/8e/f8898e79f66ec9545847915a2b306594.jpg" alt="app icon">
						</span>
						<p>Press the Submit button in order to add your review score to the total. Rating is based on <span id="totalnum">0</span> user review(s).</p>
					</td>
				</tr>
			</tbody>
		</table>
    
	  <script>
    
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          // User is signed in.
          var email = user.email;
          $("#user").html(email);
          $("#login").hide();
          $("#logout").show();
          $("#bar").show();
          $("#logout > a").click(function (event) {
            event.preventDefault();
            console.log("login");
            firebase.auth().signOut();
          });
        } else {
          $("#login").show();
          $("#logout").hide();
          $("#bar").hide();
          $("#user").hide();
        }
      });
    
      var gameName = firebase.auth().recGame.uid;
      return firebase.database().ref('/game1/' + name).once('value').then(function(snapshot) {
      document.getElementById("title").innerHTML = "REVIEWS FOR " + gameName;
      
      var review_array = new Array();
      var rating = 0;
      var fives = 0;
      var fours = 0;
      var threes = 0;
      var twos = 0;
      var ones = 0;
		
      function edit() {
        document.getElementById("star1").onmouseover = function() {starhover(1)};
        document.getElementById("star2").onmouseover = function() {starhover(2)};
        document.getElementById("star3").onmouseover = function() {starhover(3)};
        document.getElementById("star4").onmouseover = function() {starhover(4)};
        document.getElementById("star5").onmouseover = function() {starhover(5)};
        
        document.getElementById("star1").onmouseout = function() {starout()};
        document.getElementById("star2").onmouseout = function() {starout()};
        document.getElementById("star3").onmouseout = function() {starout()};
        document.getElementById("star4").onmouseout = function() {starout()};
        document.getElementById("star5").onmouseout = function() {starout()};
        
        document.getElementById("star1").onclick = function() {starclick(1)};
        document.getElementById("star2").onclick = function() {starclick(2)};
        document.getElementById("star3").onclick = function() {starclick(3)};
        document.getElementById("star4").onclick = function() {starclick(4)};
        document.getElementById("star5").onclick = function() {starclick(5)};
        
        function starhover(num) {
          if (num > 4) {
          document.getElementById("star5").src="./images/starfill.png";
          }
          if (num > 3) {
          document.getElementById("star4").src="./images/starfill.png";
          }
          if (num > 2) {
          document.getElementById("star3").src="./images/starfill.png";
          }
          if (num > 1) {
          document.getElementById("star2").src="./images/starfill.png";
          }
          if (num > 0) {
          document.getElementById("star1").src="./images/starfill.png";
          }
        }
        
        function starout() {
          if (rating < 5) {
            document.getElementById("star5").src="./images/star.png";
            if (rating < 4) {
              document.getElementById("star4").src="./images/star.png";
              if (rating < 3) {
                document.getElementById("star3").src="./images/star.png";
                if (rating < 2) {
                  document.getElementById("star2").src="./images/star.png";
                  if (rating < 1) {
                    document.getElementById("star1").src="./images/star.png";
                  }
                }
              }
            }
          }
        }
        
        function starclick(num) {
          if (num > 0)
            rating = num;
          starout();
        }
        
        function submitReview() {
          if (rating > 0) {
          review_array.push(rating);
          average();
          reviewBars(rating);
          }
        }
        document.getElementById("submit").onclick = function() {submitReview()};
        
        function average() {
        var average = 0;
        for (var i = 0; i < review_array.length; i++) {
          average = average + review_array[i];
          }
          average = average / review_array.length;
          average = average.toFixed(1);
          document.getElementById("reviewnum").innerHTML=average;
          reviewBars();
        }
        
        function reviewBars(rating) {
        var total = review_array.length;
          if (rating == 5)
            fives += 1;
          else if (rating == 4)
            fours += 1;
          else if (rating == 3)
            threes += 1;
          else if (rating == 2)
            twos += 1;
          else if (rating == 1)
            ones += 1;
          document.getElementById("bar5").style.width = (250 * (fives / total)) + "px";
          document.getElementById("bar4").style.width = (250 * (fours / total)) + "px";
          document.getElementById("bar3").style.width = (250 * (threes / total)) + "px";
          document.getElementById("bar2").style.width = (250 * (twos / total)) + "px";
          document.getElementById("bar1").style.width = (250 * (ones / total)) + "px";
          document.getElementById("totalnum").innerHTML=total;
        }
      
        document.write();
      }
		  edit();
      
	  </script>
  </body>
</html>